{
	"version": "2.0.0",
	"tasks": [
		{
			"label": "build",
			"type": "shell",
			"command": "npm",
			"args": [
				"run",
				"build"
			],
			"isBackground": false,
			"problemMatcher": [],
			"group": "build"
		},
		{
			"label": "build",
			"type": "shell",
			"command": "npm",
			"args": [
				"run",
				"build"
			],
			"isBackground": false,
			"problemMatcher": [],
			"group": "build"
		},
		{
			"label": "build",
			"type": "shell",
			"command": "npm",
			"args": [
				"run",
				"build"
			],
			"isBackground": false,
			"problemMatcher": [],
			"group": "build"
		},
		{
			"label": "build",
			"type": "shell",
			"command": "npm",
			"args": [
				"run",
				"build"
			],
			"isBackground": false,
			"problemMatcher": [],
			"group": "build"
		},
		{
			"label": "check /products/black",
			"type": "shell",
			"command": "powershell",
			"args": [
				"-NoProfile",
				"-Command",
				"$ProgressPreference='SilentlyContinue'; function Check([string]$url) { try { $r = Invoke-WebRequest -UseBasicParsing -TimeoutSec 10 $url; $loc = $r.Headers.Location; if ($loc) { Write-Output ($url + ' status=' + $r.StatusCode + ' location=' + $loc) } else { Write-Output ($url + ' status=' + $r.StatusCode) } } catch { if ($_.Exception.Response) { Write-Output ($url + ' status=' + $_.Exception.Response.StatusCode.value__) } else { Write-Output ($url + ' error=' + $_.Exception.Message) } } }; Check 'http://localhost:3000/products/black'; Check 'http://localhost:3000/products/black/'"
			],
			"isBackground": false,
			"problemMatcher": []
		},
		{
			"label": "check /products/black content",
			"type": "shell",
			"command": "powershell",
			"args": [
				"-NoProfile",
				"-Command",
				"$ProgressPreference='SilentlyContinue'; $r = Invoke-WebRequest -UseBasicParsing -TimeoutSec 10 http://localhost:3000/products/black/; $r.StatusCode; $r.Content.Substring(0,[Math]::Min(200,$r.Content.Length))"
			],
			"isBackground": false,
			"problemMatcher": []
		},
		{
			"label": "test",
			"type": "shell",
			"command": "npm",
			"args": [
				"test"
			],
			"isBackground": false,
			"problemMatcher": [],
			"group": "test"
		},
		{
			"label": "test:e2e chromium",
			"type": "shell",
			"command": "npm",
			"args": [
				"run",
				"test:e2e",
				"--",
				"--project=chromium"
			],
			"isBackground": false,
			"problemMatcher": [],
			"group": "test"
		},
		{
			"label": "test:e2e chromium (rerun)",
			"type": "shell",
			"command": "npm",
			"args": [
				"run",
				"test:e2e",
				"--",
				"--project=chromium"
			],
			"isBackground": false,
			"problemMatcher": [],
			"group": "test"
		},
		{
			"label": "test:e2e chromium (smoke+home+auth+products+cart)",
			"type": "shell",
			"command": "npm",
			"args": [
				"run",
				"test:e2e",
				"--",
				"--project=chromium",
				"e2e/smoke.spec.ts",
				"e2e/homepage.spec.ts",
				"e2e/auth.spec.ts",
				"e2e/products.spec.ts",
				"e2e/cart.spec.ts"
			],
			"isBackground": false,
			"problemMatcher": [],
			"group": "test"
		},
		{
			"label": "test:e2e chromium (smoke+home+auth+products+cart)",
			"type": "shell",
			"command": "npm",
			"args": [
				"run",
				"test:e2e",
				"--",
				"--project=chromium",
				"e2e/smoke.spec.ts",
				"e2e/homepage.spec.ts",
				"e2e/auth.spec.ts",
				"e2e/products.spec.ts",
				"e2e/cart.spec.ts"
			],
			"isBackground": false,
			"problemMatcher": [],
			"group": "test"
		},
		{
			"label": "migrate public assets",
			"type": "shell",
			"command": "powershell",
			"args": [
				"-NoProfile",
				"-ExecutionPolicy",
				"Bypass",
				"-File",
				"scripts/migrate-public-assets.ps1"
			],
			"isBackground": false,
			"problemMatcher": []
		},
		{
			"label": "migrate public assets (remaining)",
			"type": "shell",
			"command": "powershell",
			"args": [
				"-NoProfile",
				"-ExecutionPolicy",
				"Bypass",
				"-File",
				"scripts/migrate-public-assets.ps1"
			],
			"isBackground": false,
			"problemMatcher": []
		},
		{
			"label": "dev (3000)",
			"type": "shell",
			"command": "npm",
			"args": [
				"run",
				"dev",
				"--",
				"-p",
				"3000"
			],
			"isBackground": true,
			"problemMatcher": [],
			"group": "build"
		},
		{
			"label": "check headers 127.0.0.1:3000",
			"type": "shell",
			"command": "powershell",
			"args": [
				"-NoProfile",
				"-Command",
				"try { $r = Invoke-WebRequest -UseBasicParsing -Method Head http://127.0.0.1:3000/; $csp = $r.Headers['Content-Security-Policy']; $hsts = $r.Headers['Strict-Transport-Security']; \"Status: $($r.StatusCode)\"; \"HSTS: $($hsts ?? '<none>')\"; \"CSP has upgrade-insecure-requests: $($csp -match 'upgrade-insecure-requests')\"; \"CSP frame-ancestors: $((($csp -split ';') | Where-Object { $_ -match 'frame-ancestors' }) -join ';').Trim()\" } catch { if ($_.Exception.Response) { $_.Exception.Response.StatusCode.value__ } else { $_.Exception.Message } }"
			],
			"isBackground": false,
			"problemMatcher": []
		},
		{
			"label": "check headers 127.0.0.1:3000 (simple)",
			"type": "shell",
			"command": "powershell",
			"args": [
				"-NoProfile",
				"-Command",
				"try { $r = Invoke-WebRequest -UseBasicParsing -Method Head http://127.0.0.1:3000/; $csp = $r.Headers['Content-Security-Policy']; $hsts = $r.Headers['Strict-Transport-Security']; \"Status: $($r.StatusCode)\"; \"HSTS: $($hsts)\"; \"Has upgrade-insecure-requests: $($csp -match 'upgrade-insecure-requests')\" } catch { if ($_.Exception.Response) { $_.Exception.Response.StatusCode.value__ } else { $_.Exception.Message } }"
			],
			"isBackground": false,
			"problemMatcher": []
		},
		{
			"label": "build (no turbopack)",
			"type": "shell",
			"command": "powershell",
			"args": [
				"-NoProfile",
				"-ExecutionPolicy",
				"Bypass",
				"-Command",
				"$env:NEXT_DISABLE_TURBOPACK='1'; npm run build"
			],
			"isBackground": false,
			"problemMatcher": [],
			"group": "build"
		},
		{
			"label": "check /products",
			"type": "shell",
			"command": "powershell",
			"args": [
				"-NoProfile",
				"-Command",
				"try { (Invoke-WebRequest -UseBasicParsing -TimeoutSec 10 http://localhost:3000/products).StatusCode } catch { if ($_.Exception.Response) { $_.Exception.Response.StatusCode.value__ } else { $_.Exception.Message } }"
			],
			"isBackground": false
		},
		{
			"label": "check /products content",
			"type": "shell",
			"command": "powershell",
			"args": [
				"-NoProfile",
				"-Command",
				"$ProgressPreference='SilentlyContinue'; $r = Invoke-WebRequest -UseBasicParsing -TimeoutSec 10 http://localhost:3000/products; $r.StatusCode; $r.Content.Substring(0,[Math]::Min(400,$r.Content.Length))"
			],
			"isBackground": false
		}
	]
}